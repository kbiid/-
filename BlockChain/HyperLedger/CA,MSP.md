<h2>CA</h2>

하이퍼레저 패브릭은 기업형 블록체인이며 폐쇄형 블록체인이다. 허락받은 참여자만이 블록체인 네트워크에 참가가 가능하다는 것이다. 하이퍼레저 패브릭 CA는 하이퍼레저 패브릭의 어플리케이션의 일종이며 정보들을 제공한다. 이 정보들은 모여서 MSP(Membership Service Provider)를 구성한다. MSP를 통해서 채널(Channel)의 관리 권한이나 접근 권한을 관리할 수도 있다. 특정 채널에 피어가 참여하고 체인코드를 호출하기 위해 필요한 권한을 관리해준다고 생각하면 된다. 여기서도 PKI(공개키 구조 기반)

<h2>MSP</h2>

루트 인증 기관(root CA,rCA) 세트 및 선택적으로 중간 인증 기관 (ICA, intermediate CA) 세트로 구성될 수 있다. MSP의 iCA 인증서는 MSP의 rCA 중 하나에 의해 서명되어야 한다. iCA는 여러 조직에서 인증서를 발급할 때 상당한 유연성을 제공하며 Fabric에서 매우 유용하다. 조직마다 다른 rCA나 iCA의 사용이 가능하고 반대로 동일한 rCA를 사용하는 것도 가능하다.

<h3>CA에서 PKI(공개키 구조 기반)를 이용해 신뢰 체인을 통해 확인 가능한 신원을 제공할 수 있는 방법</h3>

Root CA가 존재하고 Root CA와 연결된 intermediate CA들이 존재한다. intermediate CA들이 각각 기업의 인증을 관리한다. 기업은 신원 등록(enroll)이나 신규 신원(register)요청등을 intermediate CA와 주고 받는다. 이러한 방식을 사용해 블록체인 네트워크를 재기동하지 않고 동적으로 새로운 기업이 들어와도 블록체인 네트워크에 접근이 가능하도록 구성되어 있다.

<h3>블록체인 네트워크의 신뢰할 수 있는 구성원을 나타내는 방법</h3>

MSP는 Global과 Local로 구분 가능하고 이 중에서 Global은 Network와 채널등으로 구분되고 Local은 피어(peer)와 오더러(orderer)등으로 또한 구분이 가능하다.

peer 및 orderer 노드의 MSP는 로컬, 채널 (네트워크 구성 채널 포함)의 MSP는 해당 채널의 모든 참가자간에 공유된다.

<h3>글로벌 MSP</h3>

블록체인 네트워크와 채널에 참여한 모든 구성원에 대해 적용되기 때문에 글로벌이라는 분류를 가진다. 글로벌 MSP에 정의된 내용에 따라서 블록체인 네트워크가 구성되고 이러한 정보는 제네시스 블록과 채널을 구성하는 트랜잭션에 포함된다.

  - Network MSP는 네트워크에 참여하는 조직(Organization)의 MSP를 식별한다. 따라서 어떤 조직(멤버)이 블록체인 네트워크에 참여할지를 정하는 역할을 
  해준다. 또한 네트워크를 관리하는 권한(ex. 채널 생성 등)을 가진 참여자를 식별한다.
  
  - Channel MSP는 특정 채널에 참여하는 조직을 식별한다. 채널의 관리권한을 누가 갖는지도 여기에서 Channel Policy등으로 정의되어 있다.
  
<h3>로컬 MSP</h3>

각각의 피어나 오더러등의 노드의 파일 시스템에 탑재되고 MSP를 통해 식별이나 제어 가능한 대상이 탑재된 노드에 한정되기 때문에 local이라는 분류를 가지게 된다.

  - Peer MSP는 피어의 파일 시스템에 탑재되어 Channel MSP와 비슷한 역할을 수행한다. 단 관리 범위가 해당 피어에 한정된다. 피어 MSP는 보통 소속 조직
  의 노드를 식별하거나 체인코드를 설치 가능한 피어인지 검증하기 위해 사용된다.
  
  - Orderer MSP는 OSN에 탑재되어 자신이 소속된 조직의 신뢰 가능한 노드들을 식별 가능하다.
  
<h3>로컬 MSP가 로컬 파일 시스템에 저장되는 방법</h3>

Root CAs : 해당 조직이 신뢰하는 rCA가 발급한 X.509 인증서이다. 조직에 속한 것임을 증명해주는 역할을 하기 때문에 최소 한 개는 반드시 있어야 한다.

Intermediate CAs : 해당 MSP가 속하는 조직이 신뢰하는 iCA가 발급한 X.509 인증서이다. 모든 인증서들은 rCA나 rCA와 연결된 iCA의 인증되어 있어야 한
다. 하위 조직(부서) 등을 식결할 때 유용하다.

Organizational Units : `$FABRIC_CFG_PATH/msp/config.yaml` 파일에 나열되며 Organization Unit(조직 단위)의 목록이 포함되어 있다. 이 조직 단위에 나열된 참여자들만 식별된다. 정의하지 않아도 되는데 만약 정의하지 않으면 모든 조직의 참여자들을 식별할 수 있다.

Administrators : 해당 MSP가 속해있는 조직이나 채널을 관리하는 관리자들의 인증서 목록이다. 표준 MSP 유형의 경우 이 목록에 하나 이상의 X.509 인증서가 있어야 한다.

Revoked Certificates : 만료된 인증서들의 목록이 들어있다. 개념적으로 CA의 CRL(Certification Revoation List)과 동일하지만 조직의 멤버 자격 취소와도 관련이 있다. 이는 인증서가 해질될 때만 채워진다.

Node Identity(Signing Certificates)는 해당 MSP가 들어간 노드를 식별하기 위한 인증서이다. 이 인증서를 통해서 블록체인 네트워크에 참여하는 다른 노드가 해당 노드를 보낸 메시지인지 식별하고 검증 하는 것이 가능해진다. 로컬 MSP에 필수이며, 노드에 대해 정확히 하나의 X.509 인증서가 있어야 한다. 채널 MSP에는 사용되지 않는다.

KeyStore(for Private Key) : 해당 MSP가 탑재되는 노드가 블록체인 네트워크에 발생하는 메시지에 대한 전자서명을 할 때 필요하다. 이 키는 암호화되어 Node Indentity폴더에 포함 된 노드의 ID와 일치한다. 이 폴더는 로컬 MSP에 필수적이며 정확히 하나의 개인 키를 포함해야 한다. 채널 MSP는 이 폴더를 포함하지 않는다.(채널 MSP는 ID 확인 기능만 제공하고 서명 기능은 제공하지 않기 때문이다.)

TLS Root CA : 해당 MSP가 속한 신뢰하는 rCA가 발급한 X.509형식의 인증서 목록이며 TLS 통신에서 사용한다. 이 폴더에는 반드시 하나 이상의 TLS Root CA X.509 인증서가 있어야한다.(TLS 통신의 예 : 피어가 ledger update 수신을 위해 오더러에 연결하는 경우)

TLS Intermediate CA : 해당 MSP가 속하는 조직이 신뢰하는 iCA가 발급한 X.509 인증서이며 TLS통신에서 사용한다. iCA처럼 선택적으로 지정 가능하기 때문에 필수는 아니다.

<h2>참고 사이트</h2>

- https://hcnam.tistory.com/23?category=828032
