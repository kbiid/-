<h2>쿠키와 세션이란?</h2>

쿠키와 세션은 http 프로토콜의 약점을 커버하기 위해서 존재한다.
http 프로토콜은 Connectionless하고 Statelee하다고 얘기한다.

ConnectionLess(비연결지향): 클라이언트가 request를 서버에 보내면, 서버는 클라이언트에게 response를 하고 서로 접속을 끊는 특성이다. (*HTTP 1.1버전에서 커넥션은 계속 열어두고(연결을 유지하고) request에 재활용하는 기능이 추가되었다. 헤더에 keep-alive라는 값을 줘서 커넥션을 재활용하는데 HTTP 1.1에서는 이것이 디폴트다. 

Stateless: 접속을 끊는 순간 클라이언트와 서버의 통신은 끝나고 상태 정보는 유지되지 않는 특성이다.

이 두 가지 특성이 http의 장점이자 약점이다.

장점은 통신을 유지하고 있을 때 낭비되는 리소스를 줄인다는 것이고 약점은 통신을 할때마다 계속 인증을 해야된다는 것이다.

이러한 문제점을 쿠키와 세션을 통해서 해결한다.

<h2>쿠키(Cookie)</h2>

쿠키는 클라이언트에 저장되는 키와 값이 들어있는 작은 데이터 파일이다.
쿠키는 이름,값,만료 날짜(쿠키 저장기간),경로 정보가 들어있다.
쿠키는 일정 시간동안 데이터를 저장할 수 있어서 로그인 상태를 유지한다.
쿠키는 클라이언트의 상태 정보를 본인 하드 디스크에 저장했다가 필요할 때 참조, 재사용한다.

- 쿠키의 원리
<ol>
  <li>클라이언트가 브라우저로 웹페이지 접속</li>
  <li>클라이언트가 요청한 웹페이지를 전송받으면서 쿠키(클라이언트의 상태정보) 하드에 저장</li>
  <li>클라이언트 재 방문시 웹페이지 요청과 함께 쿠키값도 전송</li>
  <li>지속적으로 로그인 정보를 가지고 있는 것처럼 사용</li>
</ol>

- 예시
<ol>
  <li>방문 사이트에서 아이디와 비밀번호를 저장하시겠습니까?라고 나타는 것은 쿠키로 저장하겠냐라는 뜻이다</li>
  <li>팝업이 나타날 때 "오늘은 이 창을 보지 않음"을 누르면 오늘 그 창이 뜨지 않는 것</li>
  <li>쇼핑몰에서 장바구니같은 기능을 사용하는 경우 저장형태가 쿠키이다</li>
</ol>

- 쿠키 제약 조건
<ol>
  <li>클라이언트에 총 300개까지 쿠키를 저장할 수 있다</li>
  <li>하나의 도메인당 20개의 값만 가질 수 있다(20개 초과시 가장 적게 참조된 쿠키가 지워짐)</li>
  <li>하나의 쿠키 값은 4KB까지 저장 가능</li>
</ol>

Response Header의 Set-Cookie 속성을 사용하면 클라이언트에 쿠키를 만들 수 있다.

쿠키는 사용자가 요청하지 않아도 브라우저는 Request시에 Request Header에 넣어서 알아서 서버에 전송한다.

<h2>세션(Session)</h2>

세션은 클라이언트와 웹서버 간 네트워크 연결이 지속 유지되고 있는 상태를 말한다.
즉, 사용자가 브라우저를 열어 서버에 접속한 뒤 접속을 종료할 때 시점까지를 말한다.
HTTP 프로토콜은 비접속형 프토로콜이므로, 매 접속시마다 새로운 네트워크 연결이 이루어지는데, 세션이 연결 유지를 가능하게 해준다.
클라이언트가 웹 서버에 Request를 보내면, 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는데, 이 ID를 세션이라고 부른다.
세션 ID는 임시로 저장하여 페이지 이동 시 이용하거나, 클라이언트가 재 접속 했을 때 클라이언트를 유일하게 구분하는 수단이 된다.
서버로부터 발행된 ID는 해당 서버(웹)와 클라이언트(브라우저) 메모리에 저장된다. 이때 클라이언트 메모리에 사용되는 cookie 타입은 세션 종료 시 같이 소멸되는 "Memory cookie"가 사용된다.

- 세션의 원리
<ol>
  <li>세션 ID를 서버에서 클라이언트가 다시 웹사이트에 접속시 발급해 준다.</li>
  <li>서버에서 클라이언트로 발급해준 세션 ID를 쿠키를 사용해서 저장한다.(쿠키 이름은 JSESSIONID)</li>
  <li>클라이언트는 다시 접속시, 이 쿠키(JSESSIONID)를 이용해서 세션 ID값을 서버에 전달한다.</li>
</ol>

- 세션의 장점
<ol>
  <li>각 클라이언트에게 고유 ID를 부여한다.</li>
  <li>세션 ID로 클라이언트를 구분해서 클라이언트의 요구에 맞는 서비스를 제공할 수 있다.</li>
  <li>사용했던 정보들을 서버에 저장하기 때문에 보안 면에서 쿠키보다 우수하다.</li>
</ol>

- 세션의 단점
서버에 저장되는 세션 때문에 서버에 처리를 요구하는 부하와 저장 공간을 필요로 한다.

- 예시
로그인과 같이 보안상 중요한 작업은 세션을 통해서 작동한다.

<h2>쿠키와 세션의 차이점</h2>

큰 차이점은 저장되는 위치이다.
쿠키는 클라이언트에 저장되어서 보내는 역할을 하고, 세션은 서버에 저장되어서 클라이언트에게 알려줘서 사용한다.
쿠키는 서버의 자원을 전혀 사용하지 않는다. 세션은 서버에 저장되어서 고유한 ID를 가지고 있다. 그래서 서버의 자원을 사용한다.
쿠키와 세션은 서버의 자원을 사용할 수가 있다. 쿠키와 세션의 만료되는 기간이 다르다.
쿠키는 클라이언트에 저장되어서 서버에 요청시 빠른 속도를 낸다. 세션은 서버에 정보가 있기 때문에 서버의 처리가 필요해서 쿠키보다 느린 속도를 낸다.

<h2>캐시</h2>

- 캐시는 이미지나 css,js파일 등이 사용자의 브라우저에 저장이 되는 것이다. 이를 이용해 자원이 아껴지는 것, 한번 캐시에 저장되면 브라우저를 참고하기 때문에 서버에서 변경이 되어도 변경되지 않게 보일 수 있는데 이런 부분을 캐시를 지워주거나 서버에서 클라이언트로 응답을 보낼 때 header에 캐시 만료기간을 명시하는 방법등을 이용할 수 있다.

<h2>참고 사이트</h2>

- https://juyoung-1008.tistory.com/2
- https://mohwaproject.tistory.com/176
- https://jeong-pro.tistory.com/80
